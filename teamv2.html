<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Track - Team Assessment | Sprint 5 of 32</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @font-face {
            font-family: 'Plaak';
            src: url('fonts/Plaak3Trial-43-Bold.otf') format('opentype');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Riforma';
            src: url('fonts/RiformaLL-Regular.otf') format('opentype');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        
        :root {
            --black: #000000;
            --white: #FFFFFF;
            --grey-50: #F9FAFB;
            --grey-100: #F3F4F6;
            --grey-200: #E5E7EB;
            --grey-300: #D1D5DB;
            --grey-400: #9CA3AF;
            --grey-500: #6B7280;
            --grey-600: #4B5563;
            --grey-700: #374151;
            --grey-800: #1F2937;
            --grey-900: #111827;
            --yellow-50: #fffef5;
            --yellow-100: #fffde6;
            --yellow-200: #fffacc;
            --yellow-300: #fff7a3;
            --yellow-400: #fff469;
            --yellow-500: #f0e55a;
            --green: #10B981;
            --amber: #F59E0B;
            --red: #EF4444;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Riforma', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--white);
            color: var(--black);
            line-height: 1.7;
            font-size: 16px; /* ‚úÖ FIXED: Was 14px, now 16px per brand standard */
        }
        
        h1, h2, h3, h4, .heading {
            font-family: 'Plaak', Arial, sans-serif;
            font-weight: 700;
            line-height: 1.3;
            letter-spacing: -0.01em;
        }
        
        h1 { font-size: 36px; }
        h2 { font-size: 28px; }
        h3 { font-size: 20px; }
        h4 { font-size: 16px; }
        
        /* ‚úÖ NEW: Numbered Section Style */
        .numbered-section {
            background: var(--black);
            color: var(--white);
            padding: 10px 16px;
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 0.5px;
            display: inline-block;
            margin-bottom: 12px;
        }
        
        /* Icons */
        .icon { display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .icon svg { stroke-width: 2; }
        .icon-sm svg { width: 16px; height: 16px; }
        .icon-md svg { width: 20px; height: 20px; }
        .icon-lg svg { width: 24px; height: 24px; }
        
        /* Header */
        .header {
            background: var(--black);
            color: var(--white);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .sprint-badge {
            font-size: 13px;
            color: var(--grey-400);
        }
        
        .sprint-badge strong {
            color: var(--yellow-400);
        }
        
        /* ‚úÖ IMPROVED: FTP Display with Yellow Background */
        .ftp-display {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            background: var(--yellow-400);
            color: var(--black);
            padding: 6px 12px;
            border-radius: 4px;
        }
        
        .ftp-display .icon { color: var(--black); }
        
        .logo {
            background: var(--white);
            padding: 8px 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo img {
            height: 28px;
            width: auto;
            display: block;
        }
        
        /* ‚úÖ NEW: Layout with Persistent Sidebar */
        .main-layout {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 80px);
        }
        
        /* ‚úÖ NEW: WHY/WHAT/HOW Sidebar (Always Visible) */
        .context-sidebar {
            width: 320px;
            background: var(--grey-50);
            border-right: 4px solid var(--black);
            padding: 32px 24px;
            position: sticky;
            top: 64px;
            height: fit-content;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
        }
        
        .context-sidebar h2 {
            font-size: 36px;
            margin-bottom: 16px;
            color: var(--black);
        }
        
        .context-sidebar p {
            margin-bottom: 24px;
            color: var(--grey-700);
        }
        
        .context-sidebar .context-section {
            margin-bottom: 32px;
        }
        
        .context-sidebar .context-section:last-child {
            margin-bottom: 0;
        }
        
        .context-sidebar ol {
            padding-left: 20px;
            color: var(--grey-700);
        }
        
        .context-sidebar ol li {
            margin-bottom: 8px;
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 32px 40px;
        }
        
        /* Container */
        .container {
            max-width: 800px;
        }
        
        /* Cards */
        .card {
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .card h3 {
            margin-bottom: 16px;
        }
        
        /* ‚úÖ IMPROVED: Context Box with 4px Border */
        .context-box {
            background: var(--grey-50);
            border-left: 4px solid var(--black);
            padding: 16px 20px;
            margin-bottom: 24px;
            border-radius: 2px;
        }
        
        .context-box p {
            margin-bottom: 8px;
        }
        
        .context-box p:last-child {
            margin-bottom: 0;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: 2px solid var(--black);
            background: var(--black);
            color: var(--white);
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover:not(:disabled) {
            background: var(--grey-900);
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: var(--white);
            color: var(--black);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--grey-50);
        }
        
        /* ‚úÖ NEW: Share Button with Yellow Accent */
        .btn-share {
            background: var(--yellow-400);
            color: var(--black);
            border-color: var(--yellow-400);
        }
        
        .btn-share:hover:not(:disabled) {
            background: var(--yellow-500);
            border-color: var(--yellow-500);
        }
        
        /* Assessment Grid - Typeform Style */
        .assessment-container {
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
        }
        
        .assessment-slide {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            max-width: 700px;
            width: 100%;
        }
        
        .assessment-slide.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        .question-number {
            font-family: 'Plaak', sans-serif;
            font-size: 18px;
            color: var(--grey-600);
            margin-bottom: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .statement {
            font-family: 'Plaak', sans-serif;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 32px;
            color: var(--black);
            line-height: 1.3;
        }
        
        .rating-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .rating-btn {
            width: 100%;
            padding: 20px 24px;
            border: 2px solid var(--grey-300);
            background: var(--white);
            color: var(--black);
            font-family: 'Riforma', sans-serif;
            font-size: 18px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            text-align: left;
        }
        
        .rating-btn:hover {
            border-color: var(--black);
            background: var(--grey-50);
            transform: translateX(8px);
        }
        
        .rating-btn.selected {
            border-color: var(--black);
            background: var(--black);
            color: var(--white);
            font-weight: 600;
            transform: translateX(8px);
        }
        
        
        /* Fun Fact Slide */
        .fun-fact-slide {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            max-width: 700px;
            width: 100%;
            text-align: center;
        }
        
        .fun-fact-slide.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        .fun-fact-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }
        
        .fun-fact-title {
            font-family: 'Plaak', sans-serif;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--black);
        }
        
        .fun-fact-content {
            font-size: 20px;
            line-height: 1.6;
            color: var(--grey-700);
            margin-bottom: 32px;
        }
        
        /* Navigation Buttons */
        .slide-navigation {
            display: flex;
            gap: 12px;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-hint {
            font-size: 14px;
            color: var(--grey-500);
            font-style: italic;
        }
        
        /* Score Display */
        .score-card {
            background: var(--white);
            border: 2px solid var(--grey-200);
            border-radius: 4px;
            padding: 24px;
            margin-bottom: 16px;
        }
        
        .score-card.critical {
            border-color: var(--red);
            background: #FEF2F2;
        }
        
        .score-card.moderate {
            border-color: var(--amber);
            background: #FFFBEB;
        }
        
        .score-card.healthy {
            border-color: var(--green);
            background: #F0FDF4;
        }
        
        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .score-value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'Plaak', sans-serif;
        }
        
        .score-card.critical .score-value { color: var(--red); }
        .score-card.moderate .score-value { color: var(--amber); }
        .score-card.healthy .score-value { color: var(--green); }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-badge.critical {
            background: var(--red);
            color: var(--white);
        }
        
        .status-badge.moderate {
            background: var(--amber);
            color: var(--white);
        }
        
        .status-badge.healthy {
            background: var(--green);
            color: var(--white);
        }
        
        /* ‚úÖ NEW: Priority Badge with Yellow Highlight */
        .priority-badge {
            background: var(--yellow-400);
            color: var(--black);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            display: inline-block;
            margin-bottom: 8px;
        }
        
        /* ‚úÖ NEW: Action Plan Section */
        .action-plan-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 24px;
        }
        
        .action-input-group {
            background: var(--grey-50);
            border: 2px solid var(--grey-200);
            border-radius: 4px;
            padding: 20px;
        }
        
        .action-input-group.complete {
            border-color: var(--green);
        }
        
        .action-input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--black);
        }
        
        .action-input-group input,
        .action-input-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--grey-300);
            border-radius: 4px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            transition: border-color 0.2s ease;
        }
        
        .action-input-group input:focus,
        .action-input-group textarea:focus {
            outline: none;
            border-color: var(--black);
        }
        
        .action-input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .action-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        /* Input Fields */
        input[type="text"],
        input[type="email"],
        textarea,
        select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--grey-300);
            border-radius: 4px;
            font-family: 'Riforma', sans-serif;
            font-size: 16px;
            transition: border-color 0.2s ease;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--black);
        }
        
        /* Progress Indicator */
        .progress-bar {
            background: var(--grey-200);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 32px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: var(--yellow-400);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--white);
            border-radius: 4px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 80px;
            right: 24px;
            background: var(--green);
            color: var(--white);
            padding: 16px 24px;
            border-radius: 4px;
            z-index: 3000;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-layout {
                flex-direction: column;
            }
            
            .context-sidebar {
                width: 100%;
                position: relative;
                top: 0;
                border-right: none;
                border-bottom: 4px solid var(--black);
            }
            
            .main-content {
                padding: 24px 20px;
            }
            
            .action-row {
                grid-template-columns: 1fr;
            }
        }
        
        /* Table Styles */
        table {
            font-size: 14px;
        }
        
        table th {
            font-family: 'Plaak', sans-serif;
            font-weight: 700;
            font-size: 13px;
            text-transform: uppercase;
        }
        
        table td {
            font-family: 'Riforma', sans-serif;
        }
        
        /* Utility Classes */
        .mb-1 { margin-bottom: 8px; }
        .mb-2 { margin-bottom: 16px; }
        .mb-3 { margin-bottom: 24px; }
        .mb-4 { margin-bottom: 32px; }
        .mt-1 { margin-top: 8px; }
        .mt-2 { margin-top: 16px; }
        .mt-3 { margin-top: 24px; }
        .mt-4 { margin-top: 32px; }
        
        .text-center { text-align: center; }
        .text-grey { color: var(--grey-600); }
        .font-bold { font-weight: 600; }
        
        .hidden { display: none; }
        
        /* Smooth transitions */
        .smooth {
            transition: all 0.2s ease;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="logo">
                    <img src="fast track tool logo.png" alt="Fast Track">
                </div>
                <div class="sprint-badge">
                    Sprint <strong>5</strong> of 32
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <button onclick="showGuruModal()" style="background: var(--yellow-400); color: var(--black); border: none; padding: 8px 16px; border-radius: 4px; font-family: 'Riforma', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer;">
                    <span class="icon icon-sm" style="color: var(--black);"><i data-lucide="users"></i></span>
                    Guru Mode
                </button>
                <div class="ftp-display">
                    <span class="icon icon-sm"><i data-lucide="zap"></i></span>
                    <span id="ftp-counter">0</span> FTP
                </div>
            </div>
        </div>
    </div>
    
    <!-- Guru Modal -->
    <div id="guru-modal" class="modal">
        <div class="modal-content">
            <h2 class="mb-3">Guru Mode Access</h2>
            <p class="text-grey mb-3">Enter the Guru password to access team compilation features.</p>
            <input type="password" id="guru-password" placeholder="Enter Guru password" style="margin-bottom: 16px;">
            <div style="display: flex; gap: 12px;">
                <button class="btn" onclick="validateGuruAccess()">
                    <span class="icon icon-sm"><i data-lucide="unlock"></i></span>
                    Access Guru Mode
                </button>
                <button class="btn btn-secondary" onclick="closeGuruModal()">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- ‚úÖ NEW: Persistent WHY/WHAT/HOW Sidebar -->
        <aside class="context-sidebar">
            <div class="context-section">
                <h2>WHY</h2>
                <p>Teams fail when trust breaks down. This tool exposes the cracks before they become disasters.</p>
                <p>Your ‚Ç¨20M growth target requires a team that operates like special forces‚Äînot a dysfunctional committee.</p>
            </div>
            
            <div class="context-section">
                <h2>WHAT</h2>
                <p>You'll assess your team across 5 critical dimensions based on Lencioni's model:</p>
                <p><strong>15 statements. 3 ratings each.</strong></p>
                <p>The tool identifies your top 3 weaknesses and forces immediate action.</p>
            </div>
            
            <div class="context-section">
                <h2>HOW</h2>
                <ol>
                    <li><strong>Rate honestly</strong> - Your team will see this</li>
                    <li><strong>Calculate scores</strong> - Tool does the math</li>
                    <li><strong>Define 3 actions</strong> - Who, What, When</li>
                    <li><strong>Submit & share</strong> - Public commitment</li>
                </ol>
            </div>
            
            <div class="context-box">
                <p style="font-size: 14px; color: var(--grey-600);"><strong>‚è±Ô∏è Time Required:</strong> 10-15 minutes</p>
                <p style="font-size: 14px; color: var(--grey-600);"><strong>üéØ Outcome:</strong> Top 3 dysfunctions + action plan</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Step 1: Assessment -->
                <div id="step-assessment">
                    <!-- Progress -->
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    
                    <!-- Assessment Container -->
                    <div class="assessment-container">
                        <div id="assessment-slides">
                            <!-- Slides will be inserted here by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Navigation -->
                    <div class="slide-navigation">
                        <button class="btn btn-secondary" id="btn-prev" onclick="previousSlide()" style="visibility: hidden;">
                            <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                            Previous
                        </button>
                        <div class="nav-hint" id="nav-hint">Press Enter or click your answer ‚Üë</div>
                        <button class="btn" id="btn-next" onclick="nextSlide()" disabled>
                            Next
                            <span class="icon icon-sm"><i data-lucide="arrow-right"></i></span>
                        </button>
                    </div>
                </div>
                
                <!-- Step 2: Scores -->
                <div id="step-scores" class="hidden">
                    <h1 class="mb-2">Your Team Scores</h1>
                    <p class="text-grey mb-4">Lower scores = Higher dysfunction. Focus on your bottom 3.</p>
                    
                    <div id="scores-grid">
                        <!-- Score cards will be inserted here -->
                    </div>
                    
                    <div class="context-box mt-4">
                        <p><strong>üìã What Happens Next:</strong></p>
                        <p>1. Submit your scores to the Guru</p>
                        <p>2. Guru compiles all team member scores</p>
                        <p>3. Team creates action plan TOGETHER in the 90-minute meeting</p>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn" onclick="showSubmission()">
                            Proceed to Submission
                            <span class="icon icon-sm"><i data-lucide="arrow-right"></i></span>
                        </button>
                        <button class="btn btn-secondary" onclick="goToAssessment()">
                            <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                            Back to Assessment
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: Submission -->
                <div id="step-submission" class="hidden">
                    <h1 class="mb-2">Submit Your Assessment</h1>
                    <p class="text-grey mb-4">Submit your scores to get your code for the Guru to compile.</p>
                    
                    <div class="card">
                        <h3 class="mb-2">Your Details</h3>
                        <div class="mb-3">
                            <label class="mb-1 font-bold">Full Name *</label>
                            <input type="text" id="input-name" placeholder="e.g., Alex Thompson">
                        </div>
                        <div class="mb-3">
                            <label class="mb-1 font-bold">Role/Title *</label>
                            <input type="text" id="input-role" placeholder="e.g., CEO / CTO / Head of Sales">
                        </div>
                        <div class="mb-3">
                            <label class="mb-1 font-bold">Email</label>
                            <input type="email" id="input-email" placeholder="alex@company.com (optional)">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn" onclick="submitAssessment()">
                            <span class="icon icon-sm"><i data-lucide="check"></i></span>
                            Submit Assessment
                        </button>
                        <button class="btn btn-secondary" onclick="goToScores()">
                            <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                            Back to Scores
                        </button>
                    </div>
                </div>
                
                <!-- Step 4: Confirmation -->
                <div id="step-confirmation" class="hidden">
                    <div class="text-center">
                        <div style="font-size: 64px; margin-bottom: 24px;">‚úì</div>
                        <h1 class="mb-2">Assessment Submitted</h1>
                        <p class="text-grey mb-4">Your submission code is below. Share it with your team guru for compilation.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="mb-2">Your Submission Code</h3>
                        <div style="background: var(--grey-100); padding: 16px; border-radius: 4px; font-family: monospace; font-size: 14px; word-break: break-all; margin-bottom: 16px;" id="submission-code"></div>
                        <button class="btn btn-secondary" onclick="copySubmissionCode()">
                            <span class="icon icon-sm"><i data-lucide="copy"></i></span>
                            Copy Code
                        </button>
                    </div>
                    
                    <!-- ‚úÖ NEW: Share Options -->
                    <div class="card mt-3">
                        <h3 class="mb-2">Share Your Results</h3>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button class="btn btn-share" onclick="exportToPDF()">
                                <span class="icon icon-sm"><i data-lucide="file-text"></i></span>
                                Export PDF
                            </button>
                            <button class="btn btn-secondary" onclick="shareViaEmail()">
                                <span class="icon icon-sm"><i data-lucide="mail"></i></span>
                                Email Team
                            </button>
                            <button class="btn btn-secondary" onclick="copyShareableLink()">
                                <span class="icon icon-sm"><i data-lucide="link"></i></span>
                                Copy Link
                            </button>
                        </div>
                    </div>
                    
                    <div class="context-box mt-4">
                        <p><strong>Next Steps:</strong></p>
                        <p>1. Send your code to the team guru</p>
                        <p>2. Guru will compile all assessments</p>
                        <p>3. Team meeting discusses results + actions</p>
                        <p>4. Review progress in 30 days</p>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn btn-secondary" onclick="resetTool()">
                            <span class="icon icon-sm"><i data-lucide="refresh-cw"></i></span>
                            Start New Assessment
                        </button>
                    </div>
                </div>
                
                <!-- ‚úÖ NEW: Guru Mode -->
                <div id="guru-mode" class="hidden">
                    <h1 class="mb-2">Guru Mode: Team Compilation</h1>
                    <p class="text-grey mb-4">Import team member submission codes to create the team summary for your 90-minute meeting.</p>
                    
                    <!-- Import Section -->
                    <div class="card">
                        <h3 class="mb-2">Import Team Member Codes</h3>
                        <p class="text-grey mb-3" style="font-size: 14px;">Collect submission codes from each team member and import them below.</p>
                        
                        <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                            <input type="text" id="import-code-input" placeholder="Paste team member submission code here" style="flex: 1;">
                            <button class="btn" onclick="importMemberCode()">
                                <span class="icon icon-sm"><i data-lucide="plus"></i></span>
                                Import
                            </button>
                        </div>
                        
                        <div class="context-box">
                            <p><strong>Imported: <span id="imported-count">0</span> team members</strong></p>
                        </div>
                        
                        <div id="imported-members" style="margin-top: 16px;">
                            <!-- Imported members will appear here -->
                        </div>
                    </div>
                    
                    <!-- Team Summary Section -->
                    <div id="team-summary-section" class="hidden">
                        <!-- Top 3 Priorities -->
                        <div class="card" style="background: var(--yellow-50); border: 2px solid var(--yellow-400);">
                            <h3 class="mb-3">üéØ Top 3 Focus Areas for Team Meeting</h3>
                            <div id="team-priorities" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                                <!-- Priority cards will be inserted here -->
                            </div>
                        </div>
                        
                        <!-- Variance Alerts -->
                        <div id="variance-alerts">
                            <!-- Variance alerts will be inserted here -->
                        </div>
                        
                        <!-- Team Summary Table -->
                        <div class="card">
                            <h3 class="mb-3">Team Dysfunction Scores</h3>
                            <div style="overflow-x: auto;">
                                <table id="team-summary-table" style="width: 100%; border-collapse: collapse;">
                                    <!-- Table will be inserted here -->
                                </table>
                            </div>
                        </div>
                        
                        <!-- Export Options -->
                        <div class="card">
                            <h3 class="mb-2">Export for Team Meeting</h3>
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <button class="btn btn-share" onclick="exportTeamSummary()">
                                    <span class="icon icon-sm"><i data-lucide="file-text"></i></span>
                                    Export Summary
                                </button>
                                <button class="btn btn-secondary" onclick="copyTeamSummary()">
                                    <span class="icon icon-sm"><i data-lucide="copy"></i></span>
                                    Copy to Clipboard
                                </button>
                                <button class="btn btn-secondary" onclick="printTeamSummary()">
                                    <span class="icon icon-sm"><i data-lucide="printer"></i></span>
                                    Print
                                </button>
                            </div>
                        </div>
                        
                        <!-- Meeting Agenda Reminder -->
                        <div class="context-box">
                            <h4 class="mb-2">üìã 90-Minute Team Meeting Agenda</h4>
                            <ol style="padding-left: 20px; font-size: 14px;">
                                <li><strong>Do Better Than Last Time</strong> (10 min)</li>
                                <li><strong>Present Results</strong> (20 min) - Show this summary</li>
                                <li><strong>Discuss Dysfunctions</strong> (30 min) - Focus on variance</li>
                                <li><strong>Create Action Plan</strong> (20 min) - WHO/WHAT/WHEN</li>
                                <li><strong>Reflection</strong> (10 min)</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn btn-secondary" onclick="exitGuruMode()">
                            <span class="icon icon-sm"><i data-lucide="arrow-left"></i></span>
                            Exit Guru Mode
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Assessment Data
        const DYSFUNCTIONS = [
            {
                id: 'trust',
                name: 'Absence of Trust',
                shortName: 'Trust',
                description: 'Team members are reluctant to be vulnerable with one another',
                statements: [
                    'Team members openly admit their mistakes',
                    'Team members willingly ask for help',
                    'Team members are comfortable being vulnerable'
                ]
            },
            {
                id: 'conflict',
                name: 'Fear of Conflict',
                shortName: 'Conflict',
                description: 'Teams avoid productive ideological debates',
                statements: [
                    'Team meetings are passionate and productive',
                    'The team confronts and resolves issues quickly',
                    'Team members voice their opinions freely'
                ]
            },
            {
                id: 'commitment',
                name: 'Lack of Commitment',
                shortName: 'Commitment',
                description: 'Without conflict, team members rarely buy in to decisions',
                statements: [
                    'Team leaves meetings with clear action items',
                    'Team decisions are made and executed quickly',
                    'Team members commit to decisions even when they initially disagreed'
                ]
            },
            {
                id: 'accountability',
                name: 'Avoidance of Accountability',
                shortName: 'Accountability',
                description: 'Team members hesitate to call out peers on behaviors',
                statements: [
                    'Team members hold each other accountable for deliverables',
                    'Poor performance is addressed immediately',
                    'Team members call out counterproductive behaviors'
                ]
            },
            {
                id: 'results',
                name: 'Inattention to Results',
                shortName: 'Results',
                description: 'Team members put individual needs above collective goals',
                statements: [
                    'Team willingly makes sacrifices for collective success',
                    'Team celebrates when collective goals are achieved',
                    'Individual agendas are subordinate to team goals'
                ]
            }
        ];

        // State
        let responses = {};
        let scores = {};
        let ftpPoints = 0;
        let teamAssessments = [];
        let currentSlide = 0;
        let totalSlides = 0;
        const GURU_PASSWORD = 'FASTTRACK2024'; // Change this to your desired password
        
        // Team Management Facts
        const TEAM_FACTS = [
            {
                icon: 'üéØ',
                title: 'Did You Know?',
                content: 'Teams that openly discuss mistakes are 3x more likely to innovate. Vulnerability breeds creativity.'
            },
            {
                icon: '‚ö°',
                title: 'Shocking Stat',
                content: '86% of workplace failures are caused by poor collaboration, not individual incompetence. The team dynamic is everything.'
            },
            {
                icon: 'üí°',
                title: 'Research Shows',
                content: 'High-performing teams spend 50% more time in productive conflict than dysfunctional teams. Disagreement done right accelerates progress.'
            }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderAssessmentSlides();
            updateFTPDisplay();
            lucide.createIcons();
        });

        // Render Assessment Slides (Typeform Style)
        function renderAssessmentSlides() {
            const container = document.getElementById('assessment-slides');
            let slideIndex = 0;
            let questionNumber = 1;
            
            DYSFUNCTIONS.forEach((dysfunction, dIndex) => {
                dysfunction.statements.forEach((statement, sIndex) => {
                    const itemId = `${dysfunction.id}-${sIndex}`;
                    const dysfunctionNumber = String(dIndex + 1).padStart(2, '0');
                    
                    // Create question slide
                    const slide = document.createElement('div');
                    slide.className = 'assessment-slide';
                    slide.dataset.slideIndex = slideIndex;
                    slide.dataset.itemId = itemId;
                    
                    slide.innerHTML = `
                        <div class="question-number">Question ${questionNumber} of 15</div>
                        <div class="statement">${statement}</div>
                        <div class="rating-buttons">
                            <button class="rating-btn" onclick="selectRatingSlide('${itemId}', 1, ${slideIndex})">
                                <span class="rating-label">Rarely - This almost never happens in our team</span>
                            </button>
                            <button class="rating-btn" onclick="selectRatingSlide('${itemId}', 2, ${slideIndex})">
                                <span class="rating-label">Sometimes - This happens occasionally</span>
                            </button>
                            <button class="rating-btn" onclick="selectRatingSlide('${itemId}', 3, ${slideIndex})">
                                <span class="rating-label">Usually - This happens regularly in our team</span>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(slide);
                    slideIndex++;
                    
                    // Insert fun fact after every 5th question
                    if (questionNumber % 5 === 0 && questionNumber < 15) {
                        const factIndex = (questionNumber / 5) - 1;
                        const fact = TEAM_FACTS[factIndex];
                        
                        const factSlide = document.createElement('div');
                        factSlide.className = 'fun-fact-slide';
                        factSlide.dataset.slideIndex = slideIndex;
                        
                        factSlide.innerHTML = `
                            <div class="fun-fact-icon">${fact.icon}</div>
                            <div class="fun-fact-title">${fact.title}</div>
                            <div class="fun-fact-content">${fact.content}</div>
                        `;
                        
                        container.appendChild(factSlide);
                        slideIndex++;
                    }
                    
                    questionNumber++;
                });
            });
            
            // Add final "Calculate Scores" slide
            const finalSlide = document.createElement('div');
            finalSlide.className = 'assessment-slide';
            finalSlide.dataset.slideIndex = slideIndex;
            finalSlide.innerHTML = `
                <div class="fun-fact-icon">üéâ</div>
                <div class="statement">Assessment Complete!</div>
                <p class="text-grey mb-4" style="font-size: 18px;">You've rated all 15 statements. Ready to see your team's dysfunction scores?</p>
                <button class="btn" onclick="calculateScoresFromSlides()" style="width: 100%; padding: 20px; font-size: 18px;">
                    <span class="icon icon-md"><i data-lucide="bar-chart"></i></span>
                    Calculate My Scores
                </button>
            `;
            container.appendChild(finalSlide);
            
            totalSlides = slideIndex;
            
            // Show first slide
            showSlide(0);
        }

        // Show Slide
        function showSlide(index) {
            // Hide all slides
            document.querySelectorAll('.assessment-slide, .fun-fact-slide').forEach(slide => {
                slide.classList.remove('active');
            });
            
            // Show current slide
            const slides = document.querySelectorAll('.assessment-slide, .fun-fact-slide');
            if (slides[index]) {
                slides[index].classList.add('active');
                currentSlide = index;
                
                // Update progress
                const questionsAnswered = Object.keys(responses).length;
                const percentage = (questionsAnswered / 15) * 100;
                document.getElementById('progress-fill').style.width = percentage + '%';
                
                // Update navigation buttons
                updateNavigationButtons();
                
                // Re-initialize Lucide icons
                lucide.createIcons();
            }
        }
        
        // Update Navigation Buttons
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('btn-prev');
            const nextBtn = document.getElementById('btn-next');
            const slides = document.querySelectorAll('.assessment-slide, .fun-fact-slide');
            const currentSlideEl = slides[currentSlide];
            
            // Show/hide previous button
            if (currentSlide === 0) {
                prevBtn.style.visibility = 'hidden';
            } else {
                prevBtn.style.visibility = 'visible';
            }
            
            // Handle next button
            if (currentSlide === totalSlides) {
                // Last slide (Calculate button)
                nextBtn.style.display = 'none';
            } else if (currentSlideEl.classList.contains('fun-fact-slide')) {
                // Fun fact slide - always enabled
                nextBtn.disabled = false;
                nextBtn.style.display = 'flex';
            } else if (currentSlideEl.dataset.itemId) {
                // Question slide - enable if answered
                const itemId = currentSlideEl.dataset.itemId;
                nextBtn.disabled = !responses[itemId];
                nextBtn.style.display = 'flex';
            }
        }
        
        // Select Rating in Slide
        function selectRatingSlide(itemId, value, slideIndex) {
            responses[itemId] = value;
            
            // Update button states in current slide
            const slide = document.querySelector(`[data-slide-index="${slideIndex}"]`);
            const buttons = slide.querySelectorAll('.rating-btn');
            buttons.forEach((btn, index) => {
                if (index + 1 === value) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
            
            // Award FTP (only once per question)
            if (!slide.dataset.awarded) {
                ftpPoints += 5;
                updateFTPDisplay();
                slide.dataset.awarded = 'true';
            }
            
            // Enable next button
            document.getElementById('btn-next').disabled = false;
            
            // Auto-advance after a short delay (optional, feels smooth)
            setTimeout(() => {
                nextSlide();
            }, 300);
        }
        
        // Previous Slide
        function previousSlide() {
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
            }
        }
        
        // Next Slide
        function nextSlide() {
            const slides = document.querySelectorAll('.assessment-slide, .fun-fact-slide');
            if (currentSlide < slides.length - 1) {
                showSlide(currentSlide + 1);
            }
        }
        
        // Calculate Scores from Slides
        function calculateScoresFromSlides() {
            calculateScores();
            showScores();
            
            // Bonus FTP for completion
            ftpPoints += 25;
            updateFTPDisplay();
            showToast('‚úì Assessment complete! +25 FTP');
        }

        // Update FTP Display
        function updateFTPDisplay() {
            document.getElementById('ftp-counter').textContent = ftpPoints;
        }

        // Calculate Scores
        function calculateScores() {
            DYSFUNCTIONS.forEach(dysfunction => {
                let total = 0;
                dysfunction.statements.forEach((_, index) => {
                    const itemId = `${dysfunction.id}-${index}`;
                    total += responses[itemId] || 0;
                });
                scores[dysfunction.id] = total;
            });
        }

        // Show Scores
        function showScores() {
            document.getElementById('step-assessment').classList.add('hidden');
            document.getElementById('step-scores').classList.remove('hidden');
            
            const grid = document.getElementById('scores-grid');
            grid.innerHTML = '';
            
            // Sort by score (lowest first = highest dysfunction)
            const sortedDysfunctions = [...DYSFUNCTIONS].sort((a, b) => 
                scores[a.id] - scores[b.id]
            );
            
            sortedDysfunctions.forEach((dysfunction, index) => {
                const score = scores[dysfunction.id];
                const maxScore = 9;
                const status = score >= 8 ? 'healthy' : score >= 6 ? 'moderate' : 'critical';
                
                const card = document.createElement('div');
                card.className = `score-card ${status}`;
                
                let priorityBadge = '';
                if (index < 3) {
                    priorityBadge = `<div class="priority-badge">PRIORITY #${index + 1}</div>`;
                }
                
                const dysfunctionNumber = String(DYSFUNCTIONS.indexOf(dysfunction) + 1).padStart(2, '0');
                
                card.innerHTML = `
                    ${priorityBadge}
                    <div class="numbered-section mb-2">[${dysfunctionNumber}] ${dysfunction.name.toUpperCase()}</div>
                    <div class="score-header">
                        <div>
                            <div class="score-value">${score}/${maxScore}</div>
                            <p class="text-grey" style="font-size: 14px; margin-top: 4px;">${dysfunction.description}</p>
                        </div>
                        <div class="status-badge ${status}">
                            ${status === 'critical' ? '‚ö†Ô∏è Critical' : status === 'moderate' ? '‚ö° Moderate' : '‚úì Healthy'}
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            window.scrollTo(0, 0);
        }

        // Show Submission
        function showSubmission() {
            document.getElementById('step-scores').classList.add('hidden');
            document.getElementById('step-submission').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // Submit Assessment
        function submitAssessment() {
            const name = document.getElementById('input-name').value.trim();
            const role = document.getElementById('input-role').value.trim();
            const email = document.getElementById('input-email').value.trim();
            
            if (!name || !role) {
                alert('Please enter your name and role');
                return;
            }
            
            // Create submission data
            const submissionData = {
                name,
                role,
                email,
                scores,
                timestamp: new Date().toISOString(),
                ftpPoints
            };
            
            // Generate code
            const code = btoa(JSON.stringify(submissionData));
            
            // Show confirmation
            document.getElementById('step-submission').classList.add('hidden');
            document.getElementById('step-confirmation').classList.remove('hidden');
            document.getElementById('submission-code').textContent = code;
            
            // Bonus FTP
            ftpPoints += 50;
            updateFTPDisplay();
            showToast('üéâ Submission complete! +50 FTP');
            
            window.scrollTo(0, 0);
        }

        // Copy Submission Code
        function copySubmissionCode() {
            const code = document.getElementById('submission-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showToast('‚úì Code copied to clipboard');
            });
        }

        // ‚úÖ NEW: Export to PDF
        function exportToPDF() {
            showToast('üìÑ Generating PDF...');
            
            setTimeout(() => {
                // This would use jsPDF to generate PDF
                // For now, show success message
                showToast('‚úì PDF export ready (feature coming soon)');
            }, 1000);
        }

        // ‚úÖ NEW: Share via Email
        function shareViaEmail() {
            const name = document.getElementById('input-name').value;
            const subject = encodeURIComponent(`Team Assessment Results - ${name}`);
            const body = encodeURIComponent(`I've completed my Fast Track team assessment.\n\nMy submission code is:\n${document.getElementById('submission-code').textContent}\n\nPlease compile this with the team results.`);
            
            window.location.href = `mailto:?subject=${subject}&body=${body}`;
        }

        // ‚úÖ NEW: Copy Shareable Link
        function copyShareableLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                showToast('‚úì Link copied to clipboard');
            });
        }

        // Navigation Functions
        function goToAssessment() {
            document.getElementById('step-scores').classList.add('hidden');
            document.getElementById('step-assessment').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function goToScores() {
            document.getElementById('step-submission').classList.add('hidden');
            document.getElementById('step-scores').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        // Reset Tool
        function resetTool() {
            if (confirm('Start a new assessment? Your current data will be lost.')) {
                responses = {};
                scores = {};
                ftpPoints = 0;
                
                document.getElementById('step-confirmation').classList.add('hidden');
                document.getElementById('step-assessment').classList.remove('hidden');
                
                // Reset all inputs
                document.querySelectorAll('input').forEach(input => input.value = '');
                document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
                document.querySelectorAll('.assessment-item').forEach(item => {
                    item.classList.remove('answered');
                    delete item.dataset.awarded;
                });
                
                updateProgress();
                updateFTPDisplay();
                window.scrollTo(0, 0);
            }
        }
        
        // ===== GURU MODE FUNCTIONS =====
        
        // Show Guru Modal
        function showGuruModal() {
            document.getElementById('guru-modal').classList.add('active');
            document.getElementById('guru-password').value = '';
            document.getElementById('guru-password').focus();
        }
        
        // Close Guru Modal
        function closeGuruModal() {
            document.getElementById('guru-modal').classList.remove('active');
        }
        
        // Validate Guru Access
        function validateGuruAccess() {
            const password = document.getElementById('guru-password').value;
            if (password === GURU_PASSWORD) {
                closeGuruModal();
                enterGuruMode();
            } else {
                alert('Incorrect password. Please try again.');
                document.getElementById('guru-password').value = '';
            }
        }
        
        // Enter Guru Mode
        function enterGuruMode() {
            // Hide all individual steps
            document.getElementById('step-assessment').classList.add('hidden');
            document.getElementById('step-scores').classList.add('hidden');
            document.getElementById('step-submission').classList.add('hidden');
            document.getElementById('step-confirmation').classList.add('hidden');
            
            // Show Guru Mode
            document.getElementById('guru-mode').classList.remove('hidden');
            
            // Render imported list
            renderImportedList();
            
            window.scrollTo(0, 0);
            showToast('‚úì Guru Mode activated');
        }
        
        // Exit Guru Mode
        function exitGuruMode() {
            document.getElementById('guru-mode').classList.add('hidden');
            document.getElementById('step-assessment').classList.remove('hidden');
            window.scrollTo(0, 0);
        }
        
        // Import Member Code
        function importMemberCode() {
            const input = document.getElementById('import-code-input');
            const code = input.value.trim();
            
            if (!code) {
                alert('Please enter a submission code');
                return;
            }
            
            try {
                const data = JSON.parse(atob(code));
                
                // Validate data structure
                if (!data.name || !data.scores) {
                    throw new Error('Invalid code format');
                }
                
                // Check for duplicate
                if (teamAssessments.find(a => a.name === data.name)) {
                    alert(`${data.name} has already been imported`);
                    return;
                }
                
                // Add to array
                teamAssessments.push(data);
                
                // Clear input
                input.value = '';
                
                // Update UI
                renderImportedList();
                
                // Show summary if 2+ members
                if (teamAssessments.length >= 2) {
                    renderTeamSummary();
                }
                
                // Show success feedback
                showToast(`‚úì ${data.name} imported successfully`);
                
            } catch (e) {
                alert('Invalid submission code. Please check and try again.');
                console.error('Import error:', e);
            }
        }
        
        // Remove Imported Member
        function removeImportedMember(index) {
            teamAssessments.splice(index, 1);
            renderImportedList();
            if (teamAssessments.length >= 2) {
                renderTeamSummary();
            } else {
                document.getElementById('team-summary-section').classList.add('hidden');
            }
        }
        
        // Render Imported List
        function renderImportedList() {
            const container = document.getElementById('imported-members');
            const countEl = document.getElementById('imported-count');
            
            countEl.textContent = teamAssessments.length;
            
            if (teamAssessments.length === 0) {
                container.innerHTML = '<p style="color: var(--grey-500); font-style: italic;">No team members imported yet</p>';
            } else {
                container.innerHTML = teamAssessments.map((member, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: var(--grey-50); border: 1px solid var(--grey-200); border-radius: 4px; margin-bottom: 8px;">
                        <div>
                            <strong>${member.name}</strong>
                            ${member.role ? `<span style="color: var(--grey-600);"> - ${member.role}</span>` : ''}
                        </div>
                        <button onclick="removeImportedMember(${index})" style="background: none; border: none; cursor: pointer; color: var(--grey-400);">
                            <span class="icon icon-sm"><i data-lucide="x"></i></span>
                        </button>
                    </div>
                `).join('');
            }
            
            lucide.createIcons();
        }
        
        // Render Team Summary
        function renderTeamSummary() {
            if (teamAssessments.length < 2) return;
            
            document.getElementById('team-summary-section').classList.remove('hidden');
            
            // Calculate team averages
            const teamAverages = {};
            const varianceData = {};
            
            DYSFUNCTIONS.forEach(d => {
                const teamScores = teamAssessments.map(a => a.scores[d.id] || 0);
                const avg = teamScores.reduce((a, b) => a + b, 0) / teamScores.length;
                const min = Math.min(...teamScores);
                const max = Math.max(...teamScores);
                
                teamAverages[d.id] = {
                    avg: avg.toFixed(1),
                    min: min,
                    max: max,
                    range: max - min,
                    status: avg >= 8 ? 'healthy' : avg >= 6 ? 'moderate' : 'critical'
                };
                
                varianceData[d.id] = { range: max - min, min, max };
            });
            
            // Render priorities (top 3 lowest scores = highest dysfunctions)
            const sorted = Object.entries(teamAverages)
                .map(([id, data]) => ({ id, ...DYSFUNCTIONS.find(d => d.id === id), ...data }))
                .sort((a, b) => parseFloat(a.avg) - parseFloat(b.avg));
            
            const prioritiesContainer = document.getElementById('team-priorities');
            prioritiesContainer.innerHTML = sorted.slice(0, 3).map((d, i) => `
                <div style="background: var(--white); border: 2px solid ${d.status === 'critical' ? 'var(--red)' : d.status === 'moderate' ? 'var(--amber)' : 'var(--green)'}; border-radius: 4px; padding: 16px; text-align: center;">
                    <div class="priority-badge">PRIORITY #${i + 1}</div>
                    <h4 style="margin: 8px 0;">${d.name}</h4>
                    <div style="font-size: 32px; font-weight: 700; font-family: 'Plaak', sans-serif; color: ${d.status === 'critical' ? 'var(--red)' : d.status === 'moderate' ? 'var(--amber)' : 'var(--green)'};">${d.avg}/9</div>
                    <div class="status-badge ${d.status}" style="display: inline-block; margin-top: 8px;">
                        ${d.status === 'critical' ? '‚ö†Ô∏è Critical' : d.status === 'moderate' ? '‚ö° Moderate' : '‚úì Healthy'}
                    </div>
                </div>
            `).join('');
            
            // Render variance alerts
            const alertsContainer = document.getElementById('variance-alerts');
            const highVariance = Object.entries(varianceData)
                .filter(([id, data]) => data.range >= 3)
                .map(([id, data]) => ({ id, ...DYSFUNCTIONS.find(d => d.id === id), ...data }));
            
            if (highVariance.length > 0) {
                alertsContainer.innerHTML = `
                    <div class="card" style="background: var(--amber); background: #FFF3CD; border: 2px solid var(--amber);">
                        <h3 style="margin-bottom: 16px;">
                            <span class="icon icon-md"><i data-lucide="alert-triangle"></i></span>
                            Variance Alerts - Discuss These First
                        </h3>
                        ${highVariance.map(d => `
                            <div style="background: var(--white); border-left: 4px solid var(--amber); padding: 16px; margin-bottom: 12px; border-radius: 4px;">
                                <h4 style="margin-bottom: 8px;">
                                    <span class="icon icon-sm"><i data-lucide="alert-triangle"></i></span>
                                    High Variance: ${d.name}
                                </h4>
                                <p style="color: var(--grey-700);">
                                    Scores range from <strong>${d.min}</strong> to <strong>${d.max}</strong> (${d.range} point spread).
                                    This disagreement is worth discussing with the team to understand different perspectives.
                                </p>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                alertsContainer.innerHTML = '';
            }
            
            // Render table
            const table = document.getElementById('team-summary-table');
            table.innerHTML = `
                <thead style="background: var(--grey-100);">
                    <tr>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--grey-300);">Team Member</th>
                        ${DYSFUNCTIONS.map(d => `<th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--grey-300);">${d.shortName}</th>`).join('')}
                    </tr>
                </thead>
                <tbody>
                    ${teamAssessments.map(member => `
                        <tr style="border-bottom: 1px solid var(--grey-200);">
                            <td style="padding: 12px;"><strong>${member.name}</strong>${member.role ? ` <span style="color: var(--grey-500); font-weight: 400;">(${member.role})</span>` : ''}</td>
                            ${DYSFUNCTIONS.map(d => {
                                const score = member.scores[d.id] || 0;
                                const status = score >= 8 ? 'healthy' : score >= 6 ? 'moderate' : 'critical';
                                const color = status === 'healthy' ? 'var(--green)' : status === 'moderate' ? 'var(--amber)' : 'var(--red)';
                                return `<td style="padding: 12px; text-align: center; font-weight: 600; color: ${color};">${score}</td>`;
                            }).join('')}
                        </tr>
                    `).join('')}
                    <tr style="background: var(--grey-100); font-weight: 700;">
                        <td style="padding: 12px;">TEAM AVERAGE</td>
                        ${DYSFUNCTIONS.map(d => {
                            const data = teamAverages[d.id];
                            const color = data.status === 'healthy' ? 'var(--green)' : data.status === 'moderate' ? 'var(--amber)' : 'var(--red)';
                            return `<td style="padding: 12px; text-align: center; color: ${color};">${data.avg}</td>`;
                        }).join('')}
                    </tr>
                </tbody>
            `;
            
            lucide.createIcons();
        }
        
        // Export Team Summary
        function exportTeamSummary() {
            showToast('üìÑ Generating export...');
            setTimeout(() => {
                showToast('‚úì Export ready (PDF feature coming soon)');
            }, 1000);
        }
        
        // Copy Team Summary
        function copyTeamSummary() {
            if (teamAssessments.length < 2) return;
            
            // Calculate averages
            const teamAverages = {};
            DYSFUNCTIONS.forEach(d => {
                const teamScores = teamAssessments.map(a => a.scores[d.id] || 0);
                teamAverages[d.id] = (teamScores.reduce((a, b) => a + b, 0) / teamScores.length).toFixed(1);
            });
            
            // Build text summary
            let summary = `TEAM DYSFUNCTION SUMMARY\n`;
            summary += `Sprint 5 - ${teamAssessments.length} Team Members\n`;
            summary += `${'='.repeat(50)}\n\n`;
            
            summary += `INDIVIDUAL SCORES:\n`;
            summary += `-`.repeat(50) + `\n`;
            teamAssessments.forEach(m => {
                summary += `${m.name} (${m.role || 'N/A'}): `;
                summary += DYSFUNCTIONS.map(d => `${d.shortName}: ${m.scores[d.id]}`).join(' | ');
                summary += `\n`;
            });
            
            summary += `\nTEAM AVERAGES:\n`;
            summary += `-`.repeat(50) + `\n`;
            DYSFUNCTIONS.forEach(d => {
                const avg = teamAverages[d.id];
                const status = avg >= 8 ? '‚úì Healthy' : avg >= 6 ? '‚ö† Moderate' : '‚úó Critical';
                summary += `${d.name}: ${avg}/9 - ${status}\n`;
            });
            
            navigator.clipboard.writeText(summary).then(() => {
                showToast('‚úì Summary copied to clipboard');
            });
        }
        
        // Print Team Summary
        function printTeamSummary() {
            window.print();
        }

        // Show Toast
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Keyboard Support
        document.addEventListener('keydown', function(e) {
            // Guru modal
            if (document.getElementById('guru-modal').classList.contains('active')) {
                if (e.key === 'Enter') {
                    validateGuruAccess();
                } else if (e.key === 'Escape') {
                    closeGuruModal();
                }
                return;
            }
            
            // Assessment navigation
            if (!document.getElementById('step-assessment').classList.contains('hidden')) {
                if (e.key === 'Enter' && !document.getElementById('btn-next').disabled) {
                    e.preventDefault();
                    nextSlide();
                } else if (e.key === 'ArrowRight' && !document.getElementById('btn-next').disabled) {
                    e.preventDefault();
                    nextSlide();
                } else if (e.key === 'ArrowLeft' && currentSlide > 0) {
                    e.preventDefault();
                    previousSlide();
                } else if (e.key >= '1' && e.key <= '3') {
                    // Quick select with number keys
                    const slides = document.querySelectorAll('.assessment-slide, .fun-fact-slide');
                    const currentSlideEl = slides[currentSlide];
                    if (currentSlideEl && currentSlideEl.dataset.itemId) {
                        const itemId = currentSlideEl.dataset.itemId;
                        const slideIndex = parseInt(currentSlideEl.dataset.slideIndex);
                        selectRatingSlide(itemId, parseInt(e.key), slideIndex);
                    }
                }
            }
        });

        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>